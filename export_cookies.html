<!DOCTYPE html>
<html>
<head>
    <title>Instagram Cookie Exporter</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        h1 { color: #E1306C; }
        .instruction {
            background: #f0f0f0;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
        textarea {
            width: 100%;
            height: 200px;
            font-family: monospace;
            padding: 10px;
            margin: 10px 0;
        }
        button {
            background: #E1306C;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover { background: #C13584; }
        .success { color: green; font-weight: bold; }
    </style>
</head>
<body>
    <h1>üì∏ Instagram Cookie Exporter untuk Gallery-dl</h1>

    <div class="instruction">
        <h3>Instruksi:</h3>
        <ol>
            <li>Buka tab baru: <a href="https://www.instagram.com" target="_blank">https://www.instagram.com</a></li>
            <li>Pastikan Anda sudah <strong>LOGIN</strong> ke Instagram</li>
            <li>Kembali ke halaman ini</li>
            <li>Klik tombol "Export Cookies" di bawah</li>
            <li>Copy isi textarea dan save sebagai <code>cookies.txt</code></li>
        </ol>
    </div>

    <button onclick="exportCookies()">üç™ Export Cookies</button>

    <div id="result"></div>
    <textarea id="cookieOutput" readonly placeholder="Cookies akan muncul di sini..."></textarea>

    <script>
        async function exportCookies() {
            try {
                // Get cookies from instagram.com
                const cookies = await chrome.cookies.getAll({domain: '.instagram.com'});

                if (cookies.length === 0) {
                    alert('‚ùå Tidak ada cookies Instagram ditemukan!\n\nPastikan:\n1. Anda sudah login ke Instagram\n2. Buka instagram.com di tab lain terlebih dahulu');
                    return;
                }

                // Convert to Netscape format
                let netscapeCookies = '# Netscape HTTP Cookie File\n';
                netscapeCookies += '# Generated by Instagram Cookie Exporter\n\n';

                cookies.forEach(cookie => {
                    const domain = cookie.domain;
                    const flag = 'TRUE';
                    const path = cookie.path;
                    const secure = cookie.secure ? 'TRUE' : 'FALSE';
                    const expiration = cookie.expirationDate ? Math.floor(cookie.expirationDate) : '0';
                    const name = cookie.name;
                    const value = cookie.value;

                    netscapeCookies += `${domain}\t${flag}\t${path}\t${secure}\t${expiration}\t${name}\t${value}\n`;
                });

                document.getElementById('cookieOutput').value = netscapeCookies;
                document.getElementById('result').innerHTML = '<p class="success">‚úÖ Cookies berhasil di-export! (' + cookies.length + ' cookies)</p><p>Copy isi textarea di atas dan save sebagai <code>cookies.txt</code> di folder: <code>C:\\Users\\MyPC PRO\\Documents\\engagement_prediction\\</code></p>';

            } catch (error) {
                // Fallback: manual method
                document.getElementById('result').innerHTML = '<p style="color: red;">‚ö†Ô∏è Browser API tidak tersedia. Gunakan metode manual:</p>';

                const manualInstructions = `
===========================================
METODE MANUAL - COPY COOKIES DARI BROWSER
===========================================

1. Buka https://www.instagram.com (pastikan sudah LOGIN)
2. Tekan F12 (Developer Tools)
3. Buka tab "Application" (Chrome) atau "Storage" (Firefox)
4. Klik "Cookies" ‚Üí "https://www.instagram.com"
5. Cari dan copy nilai cookies berikut:

   - sessionid: [copy nilainya]
   - csrftoken: [copy nilainya]
   - ds_user_id: [copy nilainya]

6. Buat file cookies.txt dengan format di bawah:

# Netscape HTTP Cookie File
.instagram.com	TRUE	/	TRUE	0	sessionid	PASTE_SESSIONID_DISINI
.instagram.com	TRUE	/	TRUE	0	csrftoken	PASTE_CSRFTOKEN_DISINI
.instagram.com	TRUE	/	TRUE	0	ds_user_id	PASTE_DS_USER_ID_DISINI

7. Save sebagai: cookies.txt
8. Jalankan: gallery-dl --cookies cookies.txt --write-metadata https://www.instagram.com/fst_unja/
`;

                document.getElementById('cookieOutput').value = manualInstructions;
            }
        }
    </script>
</body>
</html>
